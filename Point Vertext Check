// line feature class in geodatabase
var pipe_fs = FeatureSetByName($datastore, "PIPE", ["PRSU_COD"], true);

// find start and end vertex of line
var startVertex = Geometry($feature).paths[0][0];
var endVertex = Geometry($feature).paths[-1][-1];

// make 0.01m buffer of stant and end vertex 
var startBuffer = Buffer(startVertex, 0.01, "Meters")
var endBuffer = Buffer(endVertex, 0.01, "Meters")

// intersets of directional buffer and each line feature
var pipe_SB = Intersects(pipe_fs, startBuffer);
var pipe_EB = Intersects(pipe_fs, endBuffer);

var startCode = [];
var endCode = [];

for (var pipe in pipe_SB){
  Insert(startCode, 0, pipe.PRSU_COD)
}
startCode = Distinct(startCode)

for (var pipe in pipe_EB){
  Insert(endCode, 0, pipe.PRSU_COD)
}
endCode = Distinct(endCode)

return "start:"+text(startCode)+" end:"+text(endCode)
